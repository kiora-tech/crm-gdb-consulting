<section class="section">
{{ form_start(form, {attr: {class: 'filter js-filter-form'}}) }}

<div class="card">
    <div class="card-body">
        <h5 class="card-title">Filtres de recherche</h5>

        <!-- Ligne 1: Informations client principales -->
        <div class="row mb-3">
            <div class="col-md-4">
                <div class="form-floating">
                    {{ form_widget(form.name, {
                        attr: {
                            class: 'form-control',
                            id: 'floatingName'
                        }
                    }) }}
                    <label for="floatingName">{{ 'customer.name'|trans }}</label>
                    {{ form_errors(form.name) }}
                </div>
            </div>

            <div class="col-md-4">
                <div class="form-floating">
                    {{ form_widget(form.contactName, {
                        attr: {
                            class: 'form-control',
                            id: 'floatingContact'
                        }
                    }) }}
                    <label for="floatingContact">{{ 'contact.name'|trans }}</label>
                    {{ form_errors(form.contactName) }}
                </div>
            </div>

            <div class="col-md-4">
                <div class="form-floating">
                    {{ form_widget(form.code, {
                        attr: {
                            class: 'form-control',
                            id: 'floatingCode'
                        }
                    }) }}
                    <label for="floatingCode">{{ 'energy.code'|trans }}</label>
                    {{ form_errors(form.code) }}
                </div>
            </div>
        </div>

        <!-- Ligne 2: États et propriétés -->
        <div class="row mb-3">
            <div class="col-md-3">
                <div class="form-floating">
                    {{ form_widget(form.status, {
                        attr: {
                            class: 'form-select',
                            id: 'floatingStatus'
                        }
                    }) }}
                    <label for="floatingStatus">{{ 'customer.status'|trans }}</label>
                    {{ form_errors(form.status) }}
                </div>
            </div>

            <div class="col-md-3">
                <div class="form-floating">
                    {{ form_widget(form.origin, {
                        attr: {
                            class: 'form-select',
                            id: 'floatingOrigin'
                        }
                    }) }}
                    <label for="floatingOrigin">{{ 'customer.prospect_origin'|trans }}</label>
                    {{ form_errors(form.origin) }}
                </div>
            </div>

            <div class="col-md-3">
                <div class="form-floating">
                    {{ form_widget(form.leadOrigin, {
                        attr: {
                            class: 'form-control',
                            id: 'floatingLeadOrigin'
                        }
                    }) }}
                    <label for="floatingLeadOrigin">{{ 'customer.lead_origin'|trans }}</label>
                    {{ form_errors(form.leadOrigin) }}
                </div>
            </div>

            <div class="col-md-3">
                <div class="form-floating">
                    {{ form_widget(form.energyProvider) }}
                    <label for="floatingProvider">{{ 'energy.provider'|trans }}</label>
                    {{ form_errors(form.energyProvider) }}
                </div>
            </div>
        </div>

        <!-- Ligne 3: Dates et utilisateurs -->
        <div class="row mb-3">
            <div class="col-md-3">
                <div class="form-floating">
                    {{ form_widget(form.contractEndAfter, {
                        attr: {
                            class: 'form-control',
                            id: 'contractEndAfter'
                        }
                    }) }}
                    <label for="contractEndAfter">{{ 'Date de clôture après' }}</label>
                    {{ form_errors(form.contractEndAfter) }}
                </div>
                <small class="form-text text-muted">
                    Contrats expirant à partir de cette date
                </small>
            </div>

            <div class="col-md-3">
                <div class="form-floating">
                    {{ form_widget(form.contractEndBefore, {
                        attr: {
                            class: 'form-control',
                            id: 'contractEndBefore'
                        }
                    }) }}
                    <label for="contractEndBefore">{{ 'Date de clôture avant' }}</label>
                    {{ form_errors(form.contractEndBefore) }}
                </div>
                <small class="form-text text-muted">
                    Clients sans contrat plus récent que cette date
                </small>
            </div>

            {% if is_granted('ROLE_ADMIN') %}
            <div class="col-md-3">
                <div class="form-floating">
                    {{ form_widget(form.user, {
                        attr: {
                            class: 'form-control',
                            id: 'floatingUser'
                        }
                    }) }}
                    <label for="floatingUser">{{ 'user.name'|trans }}</label>
                    {{ form_errors(form.user) }}
                </div>
            </div>

            <div class="col-md-3">
                <div class="form-check form-switch mt-4 ms-2">
                    {{ form_widget(form.unassigned, {
                        attr: {
                            class: 'form-check-input',
                            id: 'unassignedSwitch'
                        }
                    }) }}
                    {{ form_errors(form.unassigned) }}
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Aide sur les filtres de contrat -->
        <div class="row mb-3">
            <div class="col-12">
                <div class="alert alert-info" role="alert">
                    <h6 class="alert-heading"><i class="bi bi-info-circle"></i> Aide sur les filtres de date de clôture</h6>
                    <small>
                        <strong>Date de clôture avant (ex: 31/12/2025) :</strong> Trouve les clients dont le dernier contrat expire avant ou à cette date. Les clients ayant un contrat plus récent sont exclus.<br>
                        <strong>Date de clôture après (ex: 01/01/2025) :</strong> Trouve les clients avec au moins un contrat expirant après cette date.<br>
                        <strong>Combinaison des deux :</strong> Trouve les clients avec un contrat dans la période spécifiée, sans contrat plus récent que la date limite.
                    </small>
                </div>
            </div>
        </div>

        <div class="text-center">
            <twig:Button
                    theme="primary"
                    label="button.filter"
                    icon="search"
                    type="submit"
            />
            <twig:Button
                    link="{{ path('app_customer_index', {'reset': 1}) }}"
                    theme="secondary"
                    label="button.reset"
                    icon="x-circle"
            />
        </div>
    </div>
</div>

{{ form_end(form) }}
</section>